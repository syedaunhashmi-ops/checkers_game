<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dino: Jump The Hoops</title>
<style>
  :root {
    --bg:#0f172a;          /* slate-900 */
    --panel:#111827;       /* gray-900 */
    --text:#e5e7eb;        /* gray-200 */
    --accent:#38bdf8;      /* sky-400 */
    --accent2:#f59e0b;     /* amber-500 */
    --good:#22c55e;        /* green-500 */
    --bad:#ef4444;         /* red-500 */
  }
  * { box-sizing: border-box; }
  html, body {
    height: 100%;
    margin: 0;
    background: radial-gradient(1200px 700px at 60% -10%, #1f2937, var(--bg));
    color: var(--text);
    font: 16px/1.4 system-ui, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji;
    user-select: none;
    -webkit-user-select: none;
    touch-action: manipulation;
  }
  .wrap {
    max-width: 900px;
    margin: 24px auto;
    padding: 0 12px;
  }
  header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    margin-bottom: 10px;
  }
  h1 {
    font-size: clamp(18px, 3.2vw, 24px);
    margin: 0;
    letter-spacing: .3px;
  }
  .hud {
    display: flex;
    align-items: center;
    gap: 16px;
    flex-wrap: wrap;
    font-weight: 600;
  }
  .pill {
    background: #0b1220aa;
    backdrop-filter: blur(6px);
    border: 1px solid #ffffff14;
    padding: 8px 10px;
    border-radius: 999px;
    font-variant-numeric: tabular-nums;
  }
  .btn {
    cursor: pointer;
    border: 1px solid #ffffff1f;
    background: linear-gradient(180deg, #1f2937, #0b1220);
    color: var(--text);
    padding: 8px 14px;
    border-radius: 12px;
    font-weight: 700;
  }
  .btn:active { transform: translateY(1px); }
  .board {
    position: relative;
    background: linear-gradient(180deg, #0b1220, #0b1220 70%, #0a0f1a 70%, #0a0f1a 100%);
    border-radius: 18px;
    border: 1px solid #ffffff18;
    box-shadow: 0 10px 30px #00000060, inset 0 1px #ffffff10;
    aspect-ratio: 16/9;
    width: 100%;
    overflow: hidden;
  }
  canvas { width: 100%; height: 100%; display: block; }
  .overlay {
    position: absolute; inset: 0; display: grid; place-items: center;
    pointer-events: none;
  }
  .overlay .panel {
    pointer-events: auto;
    background: #0b1220dd;
    border: 1px solid #ffffff1a;
    border-radius: 16px;
    padding: 16px 18px;
    text-align: center;
    max-width: 85%;
  }
  .overlay h2 { margin: 8px 0 6px; }
  .overlay p { margin: 6px 0 0; opacity: .9; }
  .kbd {
    display: inline-block; padding: 2px 8px; border-radius: 8px;
    border: 1px solid #ffffff22; background: #111827; font-weight: 700;
  }
  footer { margin-top: 10px; opacity: .85; font-size: .9rem; }
  .pulse { animation: pulse 1.2s infinite; }
  @keyframes pulse { 0%{opacity: .35} 50%{opacity: 1} 100%{opacity: .35} }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>ðŸ¦– Dino: Jump The Hoops</h1>
      <div class="hud">
        <div class="pill">Score <span id="score">0</span></div>
        <div class="pill">Best <span id="best">0</span></div>
        <button id="pauseBtn" class="btn" title="Pause/Resume (P)">Pause</button>
        <button id="restartBtn" class="btn" title="Restart (R)">Restart</button>
      </div>
    </header>

    <div class="board" id="board">
      <canvas id="game" width="900" height="506"></canvas>

      <!-- Start / Game Over overlay -->
      <div class="overlay" id="overlay">
        <div class="panel">
          <h2 id="stateTitle">Press <span class="kbd">Space</span> or tap to Start</h2>
          <p>
            Controls: <span class="kbd">Space</span>/<span class="kbd">â†‘</span> to jump, 
            <span class="kbd">P</span> to pause, <span class="kbd">R</span> to restart.
          </p>
          <p class="pulse" style="margin-top:10px;">Jump through the <b style="color:var(--accent2)">glowing hoops</b>. Touching the ring ends the run.</p>
        </div>
      </div>
    </div>

    <footer>
      Tip: Youâ€™re safe only when the dinoâ€™s body passes through the inner part of the ringâ€”not the glowing rim.
    </footer>
  </div>

<script>
(() => {
  // ===== Canvas & scaling =====
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const overlay = document.getElementById('overlay');
  const scoreEl = document.getElementById('score');
  const bestEl  = document.getElementById('best');
  const pauseBtn = document.getElementById('pauseBtn');
  const restartBtn = document.getElementById('restartBtn');

  // World units are canvas pixels at base size (900x506). Canvas is responsive via CSS.
  const W = canvas.width, H = canvas.height;

  // ===== Game state =====
  let running = false;
  let paused = false;
  let gameOver = false;
  let tLast = 0;
  let score = 0;
  let best = +localStorage.getItem('dino-hoops-best') || 0;
  bestEl.textContent = best;

  // Dino physics
  const groundY = H * 0.82;
  const dino = {
    x: W * 0.18,
    y: groundY,
    w: 42,
    h: 48,
    vy: 0,
    onGround: true
  };
  const gravity = 1800;     // px/s^2
  const jumpV   = -700;     // px/s
  let jumpQueued = false;

  // Hoops
  const hoops = [];
  let spawnTimer = 0;
  const spawnEvery = 1100; // ms between hoops (decreases slightly with difficulty)
  let speed = 280;         // world scroll speed (px/s)
  let difficultyTimer = 0;

  // Input
  function requestJump() { jumpQueued = true; }
  function onKey(e) {
    if (e.repeat) return;
    if (e.code === 'Space' || e.code === 'ArrowUp') {
      e.preventDefault();
      if (!running) startGame(); else requestJump();
    } else if (e.code === 'KeyP') {
      togglePause();
    } else if (e.code === 'KeyR') {
      restart();
    }
  }
  function onPointer() {
    if (!running) startGame(); else requestJump();
  }
  window.addEventListener('keydown', onKey, {passive:false});
  document.getElementById('board').addEventListener('pointerdown', onPointer);

  pauseBtn.addEventListener('click', togglePause);
  restartBtn.addEventListener('click', restart);

  function togglePause() {
    if (!running || gameOver) return;
    paused = !paused;
    pauseBtn.textContent = paused ? 'Resume' : 'Pause';
    overlay.style.display = paused ? 'grid' : 'none';
    document.getElementById('stateTitle').innerHTML = paused
      ? 'Paused â€” press <span class="kbd">P</span> to resume'
      : '';
    if (!paused) { tLast = performance.now(); requestAnimationFrame(loop); }
  }

  function startGame() {
    running = true;
    paused = false;
    gameOver = false;
    overlay.style.display = 'none';
    resetWorld();
    tLast = performance.now();
    requestAnimationFrame(loop);
  }

  function restart() {
    running = false;
    paused = false;
    gameOver = false;
    overlay.style.display = 'grid';
    document.getElementById('stateTitle').innerHTML =
      'Press <span class="kbd">Space</span> or tap to Start';
  }

  function resetWorld() {
    // Dino
    dino.y = groundY;
    dino.vy = 0;
    dino.onGround = true;
    // Hoops
    hoops.length = 0;
    // Score & difficulty
    score = 0;
    scoreEl.textContent = '0';
    speed = 280;
    spawnTimer = 0;
    difficultyTimer = 0;
  }

  // ===== Game loop =====
  function loop(tNow) {
    if (!running || paused) return;
    const dt = Math.min(40, tNow - tLast) / 1000; // clamp large frames
    tLast = tNow;

    update(dt);
    render();

    if (running) requestAnimationFrame(loop);
  }

  // ===== Update =====
  function update(dt) {
    // Difficulty ramps
    difficultyTimer += dt * 1000;
    if (difficultyTimer > 1500) { // every 1.5s increase difficulty a bit
      difficultyTimer = 0;
      speed = Math.min(speed + 8, 560);
    }

    // Spawn hoops
    spawnTimer += dt * 1000;
    const targetEvery = Math.max(750, spawnEvery - (speed - 280)); // tighter with speed
    if (spawnTimer >= targetEvery) {
      spawnTimer = 0;
      spawnHoop();
    }

    // Dino physics
    if (jumpQueued) {
      if (dino.onGround) {
        dino.vy = jumpV;
        dino.onGround = false;
      }
      jumpQueued = false;
    }

    dino.vy += gravity * dt;
    dino.y += dino.vy * dt;
    if (dino.y + dino.h > groundY) {
      dino.y = groundY - dino.h;
      dino.vy = 0;
      dino.onGround = true;
    }

    // Move hoops & check scoring/collision
    for (let i = hoops.length - 1; i >= 0; i--) {
      const h = hoops[i];
      h.x -= speed * dt;

      // Score when passed center once
      if (!h.passed && h.x + h.rOut < dino.x) {
        h.passed = true;
        score += 1;
        scoreEl.textContent = score;
      }

      // Remove off-screen
      if (h.x + h.rOut < -60) {
        hoops.splice(i, 1);
        continue;
      }

      // Collision check: if dino's body intersects ring thickness.
      if (ringCollision(h)) {
        endGame();
        return;
      }
    }
  }

  function spawnHoop() {
    // Ring sizes & placement
    const rOut = rand(38, 62);             // outer radius
    const thickness = rand(10, 16);        // ring thickness
    const rIn = Math.max(16, rOut - thickness);
    const centerYmin = H * 0.38;
    const centerYmax = groundY - 28;       // keep above ground
    const cy = rand(centerYmin, centerYmax);
    const cx = W + rOut + rand(0, 80);

    hoops.push({
      x: cx, y: cy, rOut: rOut, rIn: rIn,
      glow: Math.random() < 0.5 ? 'amber' : 'sky',
      passed: false
    });
  }

  function ringCollision(h) {
    // Approximate using dino center; expand inner radius by half dino diagonal for fairness.
    const dinoCx = dino.x + dino.w/2;
    const dinoCy = dino.y + dino.h/2;
    const dx = dinoCx - h.x;
    const dy = dinoCy - h.y;
    const dist = Math.hypot(dx, dy);

    // Expanded inner radius: if center is within (rIn - margin), guaranteed safe;
    // if between rIn and rOut, collision.
    const margin = Math.min(dino.w, dino.h) * 0.38;
    const safeInner = Math.max(0, h.rIn - margin);

    if (dist <= safeInner) return false;          // safely inside hoop
    if (dist >= h.rOut + margin * 0.6) return false; // clearly outside hoop + small buffer
    // Otherwise, intersecting the ring area â€” collision.
    return true;
  }

  function endGame() {
    running = false;
    gameOver = true;
    overlay.style.display = 'grid';
    document.getElementById('stateTitle').textContent =
      `Game Over â€” Score ${score}`;
    if (score > best) {
      best = score;
      localStorage.setItem('dino-hoops-best', String(best));
      bestEl.textContent = best;
      document.getElementById('stateTitle').textContent += ' (New Best!)';
    }
  }

  // ===== Render =====
  function render() {
    // Sky
    ctx.clearRect(0,0,W,H);
    drawBackground();

    // Ground line
    ctx.strokeStyle = '#1f2937';
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(0, groundY + 0.5);
    ctx.lineTo(W, groundY + 0.5);
    ctx.stroke();

    // Dino (simple pixel-dino vibe)
    drawDino();

    // Hoops
    for (const h of hoops) drawHoop(h);

    // Foreground particles / speed lines (optional nice touch)
    drawSpeedLines();
  }

  function drawBackground() {
    // Stars / dots
    ctx.globalAlpha = 0.55;
    for (let i=0;i<28;i++){
      const x = (i*137) % W;
      const y = (i*53) % (H*0.6);
      ctx.fillStyle = i%3? '#0ea5e9':'#f59e0b';
      ctx.fillRect(x, y, 2, 2);
    }
    ctx.globalAlpha = 1;
  }

  function drawDino() {
    const {x,y,w,h} = dino;

    // Body
    roundedRect(ctx, x, y, w, h, 6, '#10b981'); // green-500-ish
    // Belly
    roundedRect(ctx, x+6, y+h*0.4, w-12, h*0.45, 6, '#34d399');

    // Eye
    ctx.fillStyle = '#0b1220';
    ctx.fillRect(x + w*0.68, y + h*0.22, 6, 6);

    // Legs (simple stepping using time)
    const step = (Math.sin(performance.now()/90) * 2);
    ctx.fillStyle = '#059669';
    ctx.fillRect(x+6, y+h-8, 10, 8 + step);
    ctx.fillRect(x+w-16, y+h-8, 10, 8 - step);
  }

  function drawHoop(h) {
    // Outer glow color
    const glow = h.glow === 'amber' ? '#f59e0b' : '#38bdf8';
    // Outer ring
    ctx.save();
    ctx.shadowColor = glow;
    ctx.shadowBlur = 18;
    ctx.lineWidth = h.rOut - h.rIn;
    ctx.strokeStyle = glow;
    ctx.beginPath();
    ctx.arc(h.x, h.y, (h.rOut + h.rIn)/2, 0, Math.PI*2);
    ctx.stroke();
    ctx.restore();

    // Subtle inner inner edge
    ctx.lineWidth = 1;
    ctx.strokeStyle = '#ffffff22';
    ctx.beginPath();
    ctx.arc(h.x, h.y, h.rIn, 0, Math.PI*2);
    ctx.stroke();

    // Score indicator line at hoop center
    ctx.globalAlpha = 0.2;
    ctx.beginPath();
    ctx.moveTo(h.x, h.y - h.rOut - 10);
    ctx.lineTo(h.x, h.y + h.rOut + 10);
    ctx.strokeStyle = '#ffffff';
    ctx.stroke();
    ctx.globalAlpha = 1;
  }

  function drawSpeedLines() {
    ctx.globalAlpha = 0.25;
    ctx.strokeStyle = '#94a3b8';
    ctx.lineWidth = 1;
    const rows = 5;
    for (let i=0;i<rows;i++){
      const y = groundY - 20 - i*22;
      ctx.beginPath();
      const offset = (performance.now()/3) % 80;
      for (let x=0; x<W; x+=80) {
        ctx.moveTo(W - ((x+offset)%W), y);
        ctx.lineTo(W - ((x+36+offset)%W), y);
      }
      ctx.stroke();
    }
    ctx.globalAlpha = 1;
  }

  // ===== Utilities =====
  function rand(min, max) { return Math.random() * (max - min) + min; }
  function roundedRect(c, x,y,w,h,r,color) {
    c.beginPath();
    c.moveTo(x+r, y);
    c.arcTo(x+w, y,   x+w, y+h, r);
    c.arcTo(x+w, y+h, x,   y+h, r);
    c.arcTo(x,   y+h, x,   y,   r);
    c.arcTo(x,   y,   x+w, y,   r);
    c.closePath();
    c.fillStyle = color;
    c.fill();
  }

  // ===== Kickoff in idle (show overlay) =====
  overlay.style.display = 'grid';
})();
</script>
</body>
</html>
